# R2 Markdown 备忘录工具需求文档

## 1. 项目概述

本项目旨在开发一个基于 Web 的轻量级备忘录工具，作为【存储工具】下的一个子功能（路由建议：`/storage/markdown`）。该工具使用 Cloudflare R2 作为后端存储，支持 Markdown 格式的读写，允许用户管理包含文本和图片的笔记，并提供标签分类功能。

## 2. 核心功能

### 2.1 备忘录管理 (CRUD)
*   **新建**：创建一个新的备忘录。
*   **读取**：从 R2 获取备忘录列表及详情。
*   **更新**：在线编辑备忘录内容并保存回 R2。
*   **删除**：删除不再需要的备忘录（及其关联的图片资源，可选）。

### 2.2 内容编辑
*   **Markdown 支持**：使用 Markdown 语法编写内容。
*   **图片支持**：
    *   支持在编辑器中直接粘贴图片或上传图片。
    *   图片自动上传至 R2 存储桶的指定目录（如 `images/`）。
    *   编辑器中自动插入图片的 Markdown 链接。

### 2.3 标签系统
*   **添加标签**：在编辑备忘录时，可以为其添加一个或多个标签。
*   **标签筛选**：在备忘录列表中，可以通过点击标签来筛选显示相关备忘录。

### 2.4 数据存储
*   **存储后端**：Cloudflare R2。
*   **文件格式**：每个备忘录保存为一个 `.md` 文件。
*   **元数据存储**：使用 **YAML Frontmatter** 在 Markdown 文件头部存储元数据（标题、标签、创建时间、更新时间）。

## 3. 数据结构设计

### 3.1 Markdown 文件结构
每个备忘录文件的内容示例如下：

```markdown
---
title: "项目会议记录"
tags: ["工作", "会议"]
createdAt: "2023-10-27T10:00:00Z"
updatedAt: "2023-10-27T11:30:00Z"
---

# 会议纪要

这里是正文内容...

![架构图](https://r2.example.com/images/arch-v1.png)
```

### 3.2 文件命名规范
*   备忘录文件：建议使用 UUID 或 时间戳命名，例如 `notes/20231027-100000.md`，避免文件名冲突和中文编码问题。
*   图片文件：建议存储在 `images/` 目录下，例如 `images/uuid-image.png`。

## 4. 界面布局与交互

页面采用 **左右分栏** 布局：

### 4.1 左侧栏（列表与导航）
*   **顶部操作区**：
    *   [新建备忘录] 按钮。
    *   搜索框（搜索标题或内容）。
    *   标签过滤器（展示所有已有标签，点击筛选）。
*   **列表区**：
    *   展示备忘录卡片（标题、摘要、标签、修改时间）。
    *   支持选中高亮。
    *   每项提供 [删除] 按钮。

### 4.2 右侧栏（编辑与预览）
*   **模式切换**：提供 [编辑模式] / [预览模式] / [分屏模式] 切换。
*   **元数据编辑区**：
    *   标题输入框。
    *   标签输入组件（支持输入新标签或选择已有标签）。
*   **内容编辑器**：
    *   Markdown 编辑区域（建议使用 Monaco Editor 或专门的 Markdown 编辑器组件）。
    *   支持快捷键保存（Ctrl+S）。
    *   支持粘贴图片上传。
*   **底部状态栏**：显示保存状态（已保存/未保存）、字数统计。

## 5. 技术实现路径

1.  **API 复用**：复用现有的 `R2FileManager` 中的 API 逻辑（List, Get, Put, Delete）。
2.  **前端解析**：使用 `gray-matter` 或类似库在前端解析和生成带有 YAML Frontmatter 的 Markdown 字符串。
3.  **图片上传**：
    *   监听编辑器的 `paste` 事件。
    *   检测剪贴板中的图片数据。
    *   调用 R2 Upload API 上传图片。
    *   获取返回的 URL（或构造 URL），在光标处插入 `![]()` 语法。
4.  **列表获取**：
    *   调用 R2 List API 获取所有 `.md` 文件。
    *   并发（或按需）获取文件内容以解析 Frontmatter 中的标题和标签（*注意：如果文件较多，可能需要优化，例如单独维护一个 `index.json` 索引文件，或者仅在列表加载时获取少量预览*）。
    *   **优化方案**：初期可直接遍历读取；后期建议维护一个 `meta.json` 存储所有备忘录的元数据，每次增删改时同步更新该 JSON。

## 6. 待办事项 (TODO)
- [ ] 集成 Markdown 编辑器组件。
- [ ] 实现 Frontmatter 解析逻辑。
- [ ] 实现图片粘贴上传逻辑。
- [ ] 开发标签管理 UI。